/*
 * RIVER CROSSING RIDDLE
 * 2019-05-14
*/

var elSafeZoneAnimalWrapper,elFireZoneAnimalWrapper,numOfLions=3,numOfWildebeest=3,numOfAnimals=numOfLions+numOfWildebeest,raftMaxCapacity=2,raftCrossingDuration=5e3,elClass={animal:"animal",animalsWrapper:"animals-wrapper",animalBtnAddRemove:"btn-add-remove",animalDead:"dead",lion:"lion",wildebeest:"wildebeest",raft:"raft",raftContent:"raft-content",raftCrossing:"crossing",raftInSafeZone:"in-safe-zone",raftInFireZone:"in-fire-zone",raftBtnRemoveAll:"btn-remove-all",raftBtnToSafeZone:"btn-to-safe-zone",raftBtnToFireZone:"btn-to-fire-zone",safeZone:"safe-zone",fireZone:"fire-zone",zoneHasRaft:"has-raft",gameover:"game-over",gameoverSuccess:"success",gameoverFailure:"failed",btnRestart:"btn-restart"},elSel={animal:"."+elClass.animal,animalLion:"."+elClass.animal+"."+elClass.lion,animalWildebeest:"."+elClass.animal+"."+elClass.wildebeest,animalBtnAddRemove:"."+elClass.animalBtnAddRemove,btnRestart:"."+elClass.btnRestart,numOfCrossings:"#crossings",raft:"."+elClass.raft,raftAnimalWrapper:"."+elClass.raftContent+" ."+elClass.animalsWrapper,raftBtnRemoveAll:"."+elClass.raftBtnRemoveAll,raftBtnToSafeZone:"."+elClass.raftBtnToSafeZone,raftBtnToFireZone:"."+elClass.raftBtnToFireZone,safeZone:"."+elClass.safeZone,fireZone:"."+elClass.fireZone,safeZoneAnimalWrapper:"."+elClass.safeZone+" ."+elClass.animalsWrapper,fireZoneAnimalWrapper:"."+elClass.fireZone+" ."+elClass.animalsWrapper},raft={el:null,elAnimalsWrapper:null,elBtnRemoveAll:null,elBtnToSafeZone:null,elBtnToFireZone:null,numOfCrossings:0,init:function(){this.el=document.querySelector(elSel.raft),this.elAnimalsWrapper=document.querySelector(elSel.raftAnimalWrapper),this.elBtnRemoveAll=document.querySelector(elSel.raftBtnRemoveAll),this.elBtnToSafeZone=document.querySelector(elSel.raftBtnToSafeZone),this.elBtnToFireZone=document.querySelector(elSel.raftBtnToFireZone),this.setEventListeners(),this.setInZone("fire")},setEventListeners:function(){this.elBtnToSafeZone.addEventListener("click",function(){this.crossToZone("safe")}.bind(this)),this.elBtnToFireZone.addEventListener("click",function(){this.crossToZone("fire")}.bind(this)),this.elBtnRemoveAll.addEventListener("click",function(){this.moveAnimalsToZone()}.bind(this))},hasCapacity:function(){return this.elAnimalsWrapper.querySelectorAll(elSel.animal).length<raftMaxCapacity},isInSafeZone:function(){return this.el.classList.contains(elClass.raftInSafeZone)},isInFireZone:function(){return this.el.classList.contains(elClass.raftInFireZone)},addAnimal:function(e){this.elAnimalsWrapper.prepend(e)},setNumOfCrossings:function(e){void 0!==e?this.numOfCrossings=e:this.numOfCrossings++,document.querySelector(elSel.numOfCrossings).innerText=this.numOfCrossings},setInZone:function(e){this.el.classList.remove(elClass.raftCrossing,elClass.raftInFireZone,elClass.raftInSafeZone),this.el.classList.add("safe"===e?elClass.raftInSafeZone:elClass.raftInFireZone)},crossToZone:function(e){this.setInZone(e),this.el.classList.add(elClass.raftCrossing),zone.removeHasRaft(),setTimeout(function(){this.setNumOfCrossings(),this.el.classList.remove(elClass.raftCrossing),zone.setHasRaft(e),checkGameStatus()}.bind(this),raftCrossingDuration)},moveAnimalsToZone:function(){var e=this.elAnimalsWrapper.querySelectorAll(elSel.animal),n=this.isInSafeZone()?"safe":"fire";Array.from(e).forEach(function(e){zone.addAnimal(n,e)})},getAnimals:function(){return{lion:this.elAnimalsWrapper.querySelectorAll(elSel.animalLion).length,wildebeest:this.elAnimalsWrapper.querySelectorAll(elSel.animalWildebeest).length}},setAnimalAsDead:function(){var e=this.elAnimalsWrapper.querySelectorAll(elSel.animalWildebeest);Array.from(e).forEach(function(e){e.classList.add(elClass.animalDead)})},reset:function(){this.setNumOfCrossings(0),this.setInZone("fire")}},zone={elFireZone:null,elSafeZone:null,elFireZoneAnimalWrapper:null,elSafeZoneAnimalWrapper:null,init:function(){this.elFireZone=document.querySelector(elSel.fireZone),this.elSafeZone=document.querySelector(elSel.safeZone),this.elFireZoneAnimalWrapper=document.querySelector(elSel.fireZoneAnimalWrapper),this.elSafeZoneAnimalWrapper=document.querySelector(elSel.safeZoneAnimalWrapper),this.setHasRaft("fire")},addAnimalToFireZone:function(e){this.elFireZoneAnimalWrapper.append(e)},addAnimal:function(e,n){"safe"===e?this.elSafeZoneAnimalWrapper.append(n):this.addAnimalToFireZone(n),checkGameStatus()},removeHasRaft:function(){this.elSafeZone.classList.remove(elClass.zoneHasRaft),this.elFireZone.classList.remove(elClass.zoneHasRaft)},setHasRaft:function(e){this.removeHasRaft(),"safe"===e?this.elSafeZone.classList.add(elClass.zoneHasRaft):this.elFireZone.classList.add(elClass.zoneHasRaft)},getAnimals:function(e){var n="safe"===e?this.elSafeZoneAnimalWrapper:this.elFireZoneAnimalWrapper;return{lion:n.querySelectorAll(elSel.animalLion).length,wildebeest:n.querySelectorAll(elSel.animalWildebeest).length}},setAnimalAsDead:function(e){var n=("safe"===e?this.elSafeZoneAnimalWrapper:this.elFireZoneAnimalWrapper).querySelectorAll(elSel.animalWildebeest);Array.from(n).forEach(function(e){e.classList.add(elClass.animalDead)})},isAllAnimalsSafe:function(){return this.elSafeZoneAnimalWrapper.querySelectorAll(elSel.animal).length===numOfAnimals},reset:function(){this.setHasRaft("fire")}},animal={elAnimals:null,init:function(){this.elAnimals=document.getElementsByClassName(elClass.animal);for(var e=0;e<numOfAnimals;e++){var n=e<numOfLions?"lion":"wildebeest";zone.addAnimalToFireZone(this.template(n))}},addRemoveEvent:function(){var e=this.parentElement,n=e.parentElement.parentElement,a=n.classList.contains(elClass.fireZone),s=n.classList.contains(elClass.safeZone),l=n.classList.contains(elClass.raftContent);raft.hasCapacity()&&(a&&raft.isInFireZone()||s&&raft.isInSafeZone())?raft.addAnimal(e):l&&zone.addAnimal(raft.isInSafeZone()?"safe":"fire",e)},template:function(e){var n=document.createElement("i"),a=document.createElement("i"),s=document.createElement("button"),l=document.createElement("li"),t=elClass.wildebeest,i="Wildebeest";return"lion"===e&&(t=elClass.lion,i="Lion"),n.classList.add("i-plus"),a.classList.add("i-minus"),s.classList.add("icon-btn",elClass.animalBtnAddRemove),s.setAttribute("tooltip","Add to Raft"),s.setAttribute("tooltip-remove","Remove from Raft"),s.append(n,a),s.addEventListener("click",this.addRemoveEvent),l.classList.add(elClass.animal,t),l.append(document.createTextNode(i),s),l}};function restartGame(){var e=document.getElementsByClassName(elClass.wildebeest),n=document.getElementsByClassName(elClass.lion);Array.from(n).concat(Array.from(e)).forEach(function(e){e.classList.remove(elClass.animalDead),zone.addAnimalToFireZone(e)}),document.querySelector("body").classList.remove(elClass.gameover,elClass.gameoverFailure,elClass.gameoverSuccess),raft.reset(),zone.reset()}function checkGameStatus(){var e=raft.getAnimals(),n=raft.isInSafeZone()?"safe":"fire",a="safe"==n?"fire":"safe",s=e.wildebeest+zone.getAnimals(n).wildebeest,l=zone.getAnimals(a).wildebeest,t=0<s&&e.lion+zone.getAnimals(n).lion>s,i=0<l&&zone.getAnimals(a).lion>l;t&&(raft.setAnimalAsDead(),zone.setAnimalAsDead(n)),i&&zone.setAnimalAsDead(a),t||i?document.querySelector("body").classList.add(elClass.gameover,elClass.gameoverFailure):zone.isAllAnimalsSafe()&&document.querySelector("body").classList.add(elClass.gameover,elClass.gameoverSuccess)}function init(){zone.init(),raft.init(),animal.init(),document.querySelector(elSel.btnRestart).addEventListener("click",restartGame)}document.addEventListener?document.addEventListener("DOMContentLoaded",init,!1):window.addEventListener("load",init,!1);