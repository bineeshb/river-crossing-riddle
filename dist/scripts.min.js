/*
 * RIVER CROSSING RIDDLE
 * 2019-05-12
*/

var elSafeZoneAnimalWrapper,elFireZoneAnimalWrapper,raftMaxCapacity=2,raftCrossingDuration=5e3,elClass={animal:"animal",animalsWrapper:"animals-wrapper",animalBtnAddRemove:"btn-add-remove",animalDead:"dead",lion:"lion",wildebeest:"wildebeest",raft:"raft",raftContent:"raft-content",raftCrossing:"crossing",raftInSafeZone:"in-safe-zone",raftInFireZone:"in-fire-zone",raftBtnRemoveAll:"btn-remove-all",raftBtnToSafeZone:"btn-to-safe-zone",raftBtnToFireZone:"btn-to-fire-zone",safeZone:"safe-zone",fireZone:"fire-zone",zoneHasRaft:"has-raft",gameover:"game-over",gameoverSuccess:"success",gameoverFailure:"failed",btnRestart:"btn-restart"},elSel={animal:"."+elClass.animal,animalLion:"."+elClass.animal+"."+elClass.lion,animalWildebeest:"."+elClass.animal+"."+elClass.wildebeest,animalBtnAddRemove:"."+elClass.animalBtnAddRemove,btnRestart:"."+elClass.btnRestart,numOfCrossings:"#crossings",raft:"."+elClass.raft,raftAnimalWrapper:"."+elClass.raftContent+" ."+elClass.animalsWrapper,raftBtnRemoveAll:"."+elClass.raftBtnRemoveAll,raftBtnToSafeZone:"."+elClass.raftBtnToSafeZone,raftBtnToFireZone:"."+elClass.raftBtnToFireZone,safeZone:"."+elClass.safeZone,fireZone:"."+elClass.fireZone,safeZoneAnimalWrapper:"."+elClass.safeZone+" ."+elClass.animalsWrapper,fireZoneAnimalWrapper:"."+elClass.fireZone+" ."+elClass.animalsWrapper},raft={el:null,elAnimalsWrapper:null,elBtnRemoveAll:null,elBtnToSafeZone:null,elBtnToFireZone:null,numOfCrossings:0,init:function(){this.el=document.querySelector(elSel.raft),this.elAnimalsWrapper=document.querySelector(elSel.raftAnimalWrapper),this.elBtnRemoveAll=document.querySelector(elSel.raftBtnRemoveAll),this.elBtnToSafeZone=document.querySelector(elSel.raftBtnToSafeZone),this.elBtnToFireZone=document.querySelector(elSel.raftBtnToFireZone),this.setEventListeners(),this.setInZone("fire")},setEventListeners:function(){this.elBtnToSafeZone.addEventListener("click",function(){this.crossToZone("safe")}.bind(this)),this.elBtnToFireZone.addEventListener("click",function(){this.crossToZone("fire")}.bind(this)),this.elBtnRemoveAll.addEventListener("click",function(){this.moveAnimalsToZone()}.bind(this))},hasCapacity:function(){return this.elAnimalsWrapper.querySelectorAll(elSel.animal).length<raftMaxCapacity},isInSafeZone:function(){return this.el.classList.contains(elClass.raftInSafeZone)},isInFireZone:function(){return this.el.classList.contains(elClass.raftInFireZone)},addAnimal:function(e){this.elAnimalsWrapper.prepend(e)},setNumOfCrossings:function(e){void 0!==e?this.numOfCrossings=e:this.numOfCrossings++,document.querySelector(elSel.numOfCrossings).innerText=this.numOfCrossings},setInZone:function(e){this.el.classList.remove(elClass.raftCrossing,elClass.raftInFireZone,elClass.raftInSafeZone),this.el.classList.add("safe"===e?elClass.raftInSafeZone:elClass.raftInFireZone)},crossToZone:function(e){this.setInZone(e),this.el.classList.add(elClass.raftCrossing),zone.removeHasRaft(),setTimeout(function(){this.setNumOfCrossings(),this.el.classList.remove(elClass.raftCrossing),zone.setHasRaft(e),checkGameStatus()}.bind(this),raftCrossingDuration)},moveAnimalsToZone:function(){var e=this.elAnimalsWrapper.querySelectorAll(elSel.animal),a=this.isInSafeZone()?"safe":"fire";Array.from(e).forEach(function(e){zone.addAnimal(a,e)})},getAnimals:function(){return{lion:this.elAnimalsWrapper.querySelectorAll(elSel.animalLion).length,wildebeest:this.elAnimalsWrapper.querySelectorAll(elSel.animalWildebeest).length}},setAnimalAsDead:function(){var e=this.elAnimalsWrapper.querySelectorAll(elSel.animalWildebeest);Array.from(e).forEach(function(e){e.classList.add(elClass.animalDead)})},reset:function(){this.setNumOfCrossings(0),this.setInZone("fire")}},zone={elFireZone:null,elSafeZone:null,elFireZoneAnimalWrapper:null,elSafeZoneAnimalWrapper:null,init:function(){this.elFireZone=document.querySelector(elSel.fireZone),this.elSafeZone=document.querySelector(elSel.safeZone),this.elFireZoneAnimalWrapper=document.querySelector(elSel.fireZoneAnimalWrapper),this.elSafeZoneAnimalWrapper=document.querySelector(elSel.safeZoneAnimalWrapper),this.setHasRaft()},addAnimal:function(e,a){"safe"===e?this.elSafeZoneAnimalWrapper.append(a):this.elFireZoneAnimalWrapper.append(a),checkGameStatus()},removeHasRaft:function(){this.elSafeZone.classList.remove(elClass.zoneHasRaft),this.elFireZone.classList.remove(elClass.zoneHasRaft)},setHasRaft:function(e){this.removeHasRaft(),"safe"===e?this.elSafeZone.classList.add(elClass.zoneHasRaft):this.elFireZone.classList.add(elClass.zoneHasRaft)},getAnimals:function(e){var a="safe"===e?this.elSafeZoneAnimalWrapper:this.elFireZoneAnimalWrapper;return{lion:a.querySelectorAll(elSel.animalLion).length,wildebeest:a.querySelectorAll(elSel.animalWildebeest).length}},setAnimalAsDead:function(e){var a=("safe"===e?this.elSafeZoneAnimalWrapper:this.elFireZoneAnimalWrapper).querySelectorAll(elSel.animalWildebeest);Array.from(a).forEach(function(e){e.classList.add(elClass.animalDead)})},isAllAnimalsSafe:function(){return 6===this.elSafeZoneAnimalWrapper.querySelectorAll(elSel.animal).length}};function setAnimalEvents(){var e=document.getElementsByClassName(elClass.animal);Array.from(e).forEach(function(l){l.querySelector(elSel.animalBtnAddRemove).addEventListener("click",function(){var e=l.parentElement.parentElement,a=e.classList.contains(elClass.fireZone),n=e.classList.contains(elClass.safeZone),s=e.classList.contains(elClass.raftContent);raft.hasCapacity()&&(a&&raft.isInFireZone()||n&&raft.isInSafeZone())?raft.addAnimal(l):s&&zone.addAnimal(raft.isInSafeZone()?"safe":"fire",l)})})}function restartGame(){var e=document.getElementsByClassName(elClass.wildebeest),a=document.getElementsByClassName(elClass.lion);Array.from(a).concat(Array.from(e)).forEach(function(e){e.classList.remove(elClass.animalDead),zone.elFireZoneAnimalWrapper.append(e)}),document.querySelector("body").classList.remove(elClass.gameover,elClass.gameoverFailure,elClass.gameoverSuccess),raft.reset(),zone.setHasRaft("fire")}function checkGameStatus(){var e=raft.getAnimals(),a=raft.isInSafeZone()?"safe":"fire",n="safe"==a?"fire":"safe",s=e.wildebeest+zone.getAnimals(a).wildebeest,l=zone.getAnimals(n).wildebeest,t=0<s&&e.lion+zone.getAnimals(a).lion>s,i=0<l&&zone.getAnimals(n).lion>l;t&&(raft.setAnimalAsDead(),zone.setAnimalAsDead(a)),i&&zone.setAnimalAsDead(n),t||i?document.querySelector("body").classList.add(elClass.gameover,elClass.gameoverFailure):zone.isAllAnimalsSafe()&&document.querySelector("body").classList.add(elClass.gameover,elClass.gameoverSuccess)}function init(){zone.init(),raft.init(),setAnimalEvents(),document.querySelector(elSel.btnRestart).addEventListener("click",function(){restartGame()})}document.addEventListener?document.addEventListener("DOMContentLoaded",init,!1):window.addEventListener("load",init,!1);